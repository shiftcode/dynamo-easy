language: node_js
node_js:
- lts/*

cache: npm
#  directories:
#  - $HOME/.npm
#  - node_modules

addons:
  sonarcloud:
    organization: shiftcode
    token: $SONAR_TOKEN

# npm ci will not work with branches created from greenkeeper, because those need to update the package-lock.json
# From https://github.com/greenkeeperio/greenkeeper-lockfile#npm:
# If dependencies in the package lock do not match those in package.json, npm ci will exit with an error, instead
# of updating the package lock.
install:
- npm ci

notifications:
  email: false

before_script: npx greenkeeper-lockfile-update

script:
- sonar-scanner
- npm run lint:ci
- npm run test:ci
- npm run build
- npm run build:docs

after_script: npx greenkeeper-lockfile-upload

after_success:
- npm run report-coverage
- npm run deploy-docs
- npx semantic-release
